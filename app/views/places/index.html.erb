<%# render category list %>
<div class="main-content-container">
  <div class="places-list">
    <% @places.each do |place| %>
      <div id="place_<%= place.id %>" class="place">
        <div class="posts-list">
          <% place.posts[0..4].each_with_index do |post, index| %>
            <div id="post_<%= post.id %>" class="post <%= 'active' if index.zero? %>">
              <%= render partial: 'post', locals: { post: post } %>
            </div>
          <% end %>
        </div>

        <button class="prev">Previous</button>
        <button class="next">Next</button>
        <% if current_user && !current_user.favourites.exists?(place_id: place.id) %>
          <%= button_to "Favourite", favourites_path(place_id: place.id), method: :post, class: "favourite" %>
      
        <% else %>
          <%= button_to "Unfavourite", favourites_path(place_id: place.id), method: :delete, class: "favourite" %>
        <% end %>

        <div class="content-info">
          <h2 class="place-name"><%= place.name %></h2>
          <img src="" alt="" class="avatar">
          <p class="post-username">username</p>
          <p class="post-caption"></p>
        </div>
      </div>
    <% end %>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const favoriteButtons = document.querySelectorAll(".favourite");

    favoriteButtons.forEach(button => {
      button.addEventListener("click", () => {
        const placeId = button.getAttribute("data-place-id");

        // Send AJAX request to favorite action
        fetch(`/favourites?place_id=${placeId}`, { method: "POST" })
          .then(response => {
            if (response.ok) {
              // Favourite request successful
              console.log("Place favorited");
            } else {
              // Handle error
              console.error("Failed to favorite place");
            }
          })
          .catch(error => {
            console.error("Failed to favorite place", error);
          });
      });
    });
  });
</script>
